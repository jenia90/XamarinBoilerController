<?xml version="1.0" encoding="utf-8"?>

<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:BoilerController.Common.Converters;assembly=BoilerController.Common"
             xmlns:controls="clr-namespace:XLabs.Forms.Controls;assembly=XLabs.Forms"
             x:Class="BoilerController.Views.SchedulePage" x:Name="SchedulePageClass" Title="Schedule">
    <ContentPage.Content>
        <ScrollView Margin="10">
            <StackLayout Orientation="Vertical">
                <StackLayout Orientation="Horizontal">
                    <Label VerticalOptions="Center" Text="Start date:" />
                    <controls:ExtendedDatePicker VerticalOptions="Center" Date="{Binding OnDate, Mode=TwoWay}" />
                </StackLayout>
                <StackLayout Orientation="Horizontal">
                    <Label VerticalOptions="Center" Text="Start time:" />
                    <controls:ExtendedTimePicker VerticalOptions="Center" Time="{Binding OnTime, Mode=TwoWay}" />
                </StackLayout>
                <StackLayout Orientation="Horizontal">
                    <Label VerticalOptions="Center" Text="Duration:" />
                    <Picker VerticalOptions="Center" ItemsSource="{Binding Durations}"
                            SelectedIndex="{Binding SelectedDuration, Mode=TwoWay}" />
                </StackLayout>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <controls:CheckBox Grid.Column="0" DefaultText="{Binding Days[0].Day}" Checked="{Binding Days[0].IsSelected, Mode=TwoWay}"/>
                    <controls:CheckBox Grid.Column="1" DefaultText="{Binding Days[1].Day}" Checked="{Binding Days[1].IsSelected, Mode=TwoWay}"/>
                    <controls:CheckBox Grid.Column="2" DefaultText="{Binding Days[2].Day}" Checked="{Binding Days[2].IsSelected, Mode=TwoWay}"/>
                    <controls:CheckBox Grid.Column="3" DefaultText="{Binding Days[3].Day}" Checked="{Binding Days[3].IsSelected, Mode=TwoWay}"/>
                    <controls:CheckBox Grid.Column="4" DefaultText="{Binding Days[4].Day}" Checked="{Binding Days[4].IsSelected, Mode=TwoWay}"/>
                    <controls:CheckBox Grid.Column="5" DefaultText="{Binding Days[5].Day}" Checked="{Binding Days[5].IsSelected, Mode=TwoWay}"/>
                    <controls:CheckBox Grid.Column="6" DefaultText="{Binding Days[6].Day}" Checked="{Binding Days[6].IsSelected, Mode=TwoWay}"/>
                </Grid>

                <StackLayout Orientation="Horizontal" HorizontalOptions="Center">
                    <Button Text="Set Timer" Command="{Binding SetTimerCommand}" />
                    <Button Text="Add Cron Job" Command="{Binding SetCronCommand}" />
                    <Button Text="Get Times" Command="{Binding GetTimesCommand}" />
                </StackLayout>
                <ListView x:Name="jobsList" ItemsSource="{Binding Jobs}"
                          IsPullToRefreshEnabled="True"
                          IsRefreshing="{Binding IsRefreshing}"
                          RefreshCommand="{Binding GetTimesCommand}" VerticalOptions="FillAndExpand"
                          HasUnevenRows="True">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <ViewCell>
                                <ViewCell.ContextActions>
                                    <!--TODO: Implement this shit!-->
                                    <MenuItem Text="Update" />
                                    <MenuItem Text="Remove"
                                              Command="{Binding Path=BindingContext.DeleteCommand, Source={x:Reference Name=SchedulePageClass}}"
                                              CommandParameter="{Binding Id}"
                                              IsDestructive="True" />
                                </ViewCell.ContextActions>

                                <Grid VerticalOptions="FillAndExpand" HorizontalOptions="FillAndExpand">

                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*" />
                                        <RowDefinition Height="*" />
                                    </Grid.RowDefinitions>

                                    <Label Grid.Row="0" Grid.Column="0"
                                           Text="{Binding Path=DeviceName, StringFormat='Device: {0}'}" />
                                    <Label Grid.Row="1" Grid.Column="0"
                                           Text="{Binding Path=Start, StringFormat='Start: {0}'}" />
                                    <Label Grid.Row="1" Grid.Column="1"
                                           Text="{Binding Path=End, StringFormat='End: {0}'}" />
                                    <Label Grid.Row="0" Grid.Column="1">
                                        <Label.Text>
                                            <Binding Path="DaysList" StringFormat="Days: {0}">
                                                <Binding.Converter>
                                                    <converters:ListToStringConverter />
                                                </Binding.Converter>
                                            </Binding>
                                        </Label.Text>
                                    </Label>
                                </Grid>
                            </ViewCell>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </StackLayout>
        </ScrollView>
    </ContentPage.Content>
</ContentPage>